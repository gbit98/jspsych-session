<!DOCTYPE html>
<html>
  <head>
    <title>Method of Loci Intervention</title>
    <style>
  #jspsych-content {
    display: block !important;
    margin-top: 80px; /* adjust as needed */
    transform: none !important;
    top: auto !important;
    position: static !important;
  }
    </style>
    <script src="jatos.js"></script>
    <script src="https://unpkg.com/jspsych@8.2.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0"></script>
    <link href="https://unpkg.com/jspsych@8.2.1/css/jspsych.css" rel="stylesheet" type="text/css" />
  </head>

  <body></body>
  
  <script>
const jsPsych = initJsPsych({
  show_progress_bar: true,

});

    const timeline = [];
    const preload = {
      type: jsPsychPreload,
      images: ['Diagram1.png', 'Diagram2.png', 'Diagram3.png'],
    };
    timeline.push(preload);

const red_dot_start = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:`
  <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
    <div style="font-size: 48px; color: red;">•</div>
  </div>
`,
  choices: "NO_KEYS",
  trial_duration: 1500
};

    // Welcome Page
const Welcome_Page = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 25vh; text-align: center;">
    <div style="max-width: 800px; font-size: 18px; line-height: 1.6;">   

<p><strong>Welcome!</strong></p>

<p>In this task, you will be taught how to use a mnemonic memory strategy known as <strong>"the Method of Loci"</strong>.</p>

<p>Click "Proceed" to begin.</p>

        </div>
    `,
    choices: ["Proceed"]
  };

  // Instruction Page 1

 const instruction_page_1a = { 
type: jsPsychHtmlButtonResponse,
stimulus: `
    <div style="text-align: left; font-size: 18px; line-height: 1.6; max-width: 800px; margin: auto;">
      
         <div style="text-align: center; font-size: 36px; font-weight: 600; margin-bottom: 20px;">
        <strong>The Method of Loci:</strong>
      </div>
      
      <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>What is it?</strong>
      </div>

      
      <p>
        The Method of Loci is a powerful memory technique that uses vivid, visuo-spatial mental imagery to strengthen learning and recall. 
        It works by pairing new information with well-known physical environments and the distinctive objects within them.
      </p>
  
    </div>
  `,
  choices: ["Proceed"]
};

const instruction_page_1b = { 
type: jsPsychHtmlButtonResponse,
stimulus: `
    <div style="text-align: left; font-size: 18px; line-height: 1.6; max-width: 800px; margin: auto;">
      
         <div style="text-align: center; font-size: 36px; font-weight: 600; margin-bottom: 20px;">
        <strong>The Method of Loci:</strong>
      </div>
      
      <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>What is it?</strong>
      </div>

      
      <p>
        The Method of Loci is a powerful memory technique that uses vivid, visuo-spatial mental imagery to strengthen learning and recall. 
        It works by pairing new information with well-known physical environments and the distinctive objects within them.
      </p>

<div style="text-align: center; margin-top: 30px;">
        <img src='Diagram1.png'style="width: 75%; display: block; margin: auto;"></img> 
      </div>
    
      </div>
      `,
      choices: ["Proceed"]
    };

// Instruction Page 2
const instruction_page_2a = { 
type: jsPsychHtmlKeyboardResponse,
stimulus: `
<div style="text-align: left; font-size: 18px; line-height: 1.6; max-width: 800px; margin: auto;">
      
  <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>How Does it Work?</strong>
      </div>

      <p>
        The technique involves mentally selecting a 
        familiar physical setting, such as your home, workplace, university, or a 
        frequently travelled route, and identifying distinctive, memorable landmarks or objects within 
        that setting. These are known as your “loci” (singular: “locus”).
      </p>

      <p>
        You then imagine yourself moving through this environment in a fixed, logical sequence, 
        paying attention to each locus in order, just like following a set path or tour.
      </p>

      <p>
        At each stop along your imagined route, you create a mental image that links a piece of new 
        information to that specific location or object. These images work best when they 
        are exaggerated, unusual, or even bizarre, making them more memorable than 
        ordinary or realistic images.
      </p>

    </div>
`,
choices: "NO_KEYS",
trial_duration: 7000
};

const instruction_page_2b = { 
type: jsPsychHtmlButtonResponse,
stimulus: `
<div style="text-align: left; font-size: 18px; line-height: 1.6; max-width: 800px; margin: auto;">
      
  <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>How Does it Work?</strong>
      </div>

      <p>
        The technique involves mentally selecting a 
        familiar physical setting, such as your home, workplace, university, or a 
        frequently travelled route, and identifying distinctive, memorable landmarks or objects within 
        that setting. These are known as your “loci” (singular: “locus”).
      </p>

      <p>
        You then imagine yourself moving through this environment in a fixed, logical sequence, 
        paying attention to each locus in order, just like following a set path or tour.
      </p>

      <p>
        At each stop along your imagined route, you create a mental image that links a piece of new 
        information to that specific location or object. These images work best when they 
        are exaggerated, unusual, or even bizarre, making them more memorable than 
        ordinary or realistic images.
      </p>


    </div>
`,
choices: ["Proceed"]
};

// Instruction Page 3
const instruction_page_3a = {
type: jsPsychHtmlButtonResponse,
stimulus: `
    <div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
      <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Key Tips for Using it Effectively</strong>
      </div>

      <ol>
        <li>Choose a highly familiar environment you can easily visualise.</li>

        <li>Plan a clear, logical route through that environment, moving from one location to the next in sequence.</li>

        <li>Identify several distinctive objects or landmarks along the way—these will be your loci.</li>

        <li>Create vivid mental images that link new information to each locus, imagining these connections as you move through your route in order.</li>

        <li>Make your images exaggerated, strange, or surprising, as unusual associations are typically much more memorable than ordinary ones.</li>
      </ol>

    </div>
  `,
choices: ["Proceed"]
};


const instruction_page_3b = {
type: jsPsychHtmlButtonResponse,
stimulus: `
    <div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
      <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Key Tips for Using it Effectively</strong>
      </div>

      <ol>
        <li>Choose a highly familiar environment you can easily visualise.</li>

        <li>Plan a clear, logical route through that environment, moving from one location to the next in sequence.</li>

        <li>Identify several distinctive objects or landmarks along the way—these will be your loci.</li>

        <li>Create vivid mental images that link new information to each locus, imagining these connections as you move through your route in order.</li>

        <li>Make your images exaggerated, strange, or surprising, as unusual associations are typically much more memorable than ordinary ones.</li>
      </ol>

      <img src='Diagram2.png'style="width: 75%; display: block; margin: auto;"></img> 
      </div>
    </div>
  `,
choices: ["Proceed"]
};

// Practice Example Page 1
const instruction_page_4a = {
type: jsPsychHtmlKeyboardResponse,
stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
    <div style="text-align: center; font-size: 36px; font-weight: 600; margin-bottom: 20px;">
        Applying the Method of Loci:
      </div>

    <p>Let's practice using the Method of Loci!</p>

   <div style=" font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Practice Question #1</strong>
      </div>

    <p>How might you remember the word <strong>“telescope”</strong> if your route starts at the <strong>front door</strong> of your home?</p>

    <p><em>Take about 10 seconds now to create your own mental image.</em></p>
    
    </div>
`,
choices: "NO_KEYS",
trial_duration: 15000
    };

const instruction_page_4b = {
type: jsPsychHtmlButtonResponse,
stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
    <div style="text-align: center; font-size: 36px; font-weight: 600; margin-bottom: 20px;">
        Applying the Method of Loci:
      </div>

    <p>Let's practice using the Method of Loci!</p>

   <div style=" font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Practice Question #1</strong>
      </div>

    <p>How might you remember the word <strong>“telescope”</strong> if your route starts at the <strong>front door</strong> of your home?</p>

    <p><em>Take about 10 seconds now to create your own mental image.</em></p>
    
    </div>
`,
choices: ["Proceed"]
    };

const instruction_page_4c = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
    <div style="text-align: center; font-size: 36px; font-weight: 600; margin-bottom: 20px;">
        Applying the Method of Loci:
      </div>

    <p>Let's practice using the Method of Loci!</p>

   <div style=" font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Practice Question #1</strong>
      </div>

    <p>How might you remember the word <strong>“telescope”</strong> if your route starts at the <strong>front door</strong> of your home?</p>

    <p><em>Take about 10 seconds now to create your own mental image.</em></p>

<div style= font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Example Association</strong>
      </div>

      <p>
        You might imagine approaching your front door, only to find a small telescope mounted 
        where the peephole should be. Curious, you lean in and look through it, expecting to see 
        inside your house, but instead, you see a tiny, animated solar system spinning behind 
        the door.
      </p>

      <p>
        This strange and unexpected image helps make the word “telescope” memorable, 
        while anchoring it to the first stop on your sequential memory route.
      </p>

      <p><em>
        Let’s try another example. This time, memorising a task that you intend to 
        complete later.
      </em></p>

    </div>
`,
choices: ["Proceed"]
};

// Practice Example Page 2
const instruction_page_5a = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">

 <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Practice Question #2</strong>
      </div>

      <p>
        How might you create a memorable mental image to associate the task <strong>“reset router”</strong> 
        with a familiar object in your <strong>kitchen</strong>?
      </p>
    
      <p><em>
        Take about 10-20 seconds now to create your own mental image.    
      </em></p>

    </div>
`,
  choices: "NO_KEYS",
  trial_duration: 15000
}; 

const instruction_page_5b = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">

 <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Practice Question #2</strong>
      </div>

      <p>
        How might you create a memorable mental image to associate the task <strong>“reset router”</strong> 
        with a familiar object in your <strong>kitchen</strong>?
      </p>
    
      <p><em>
        Take about 10-20 seconds now to create your own mental image.    
      </em></p>

    </div>
`,
  choices: ["Proceed"]
};

const instruction_page_5c =  {
type: jsPsychHtmlButtonResponse,
stimulus: `
    <div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">

       <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Practice Question #2</strong>
      </div>

      <p>
        How might you create a memorable mental image to associate the task <strong>“reset router”</strong> 
        with a familiar object in your <strong>kitchen</strong>?
      </p>
    
      <p><em>
        Take about 10-20 seconds now to create your own mental image.    
      </em></p>

      
      <div style= font-size: 22px; font-weight: 600; margin-bottom: 12px;">

      <strong>Example Association</strong>
      </div>

      <p>
        You might picture yourself walking into your kitchen and noticing that your toaster has 
       transformed into a glowing internet router.
      </p>

      <p>
        The toaster’s slots are flashing with colourful Wi-Fi symbol lights, and instead of toast popping out, it’s 
        shooting out glowing Wi-Fi signals.
      </p>

      <p>
        You reach out and push the toaster’s lever down, imagining that this 
        "resets" the router. This momentarily causes the toaster to shut down, before
        restarting, flashing even brighter lights, and shooting out Wi-Fi signals that swirl through the air.
      </p>

      <p><em>
        Notice how the image is not only tied to a familiar object (the toaster) but also includes a 
        distinctive and exaggerated action that represents the task itself. Making both the locus and 
        the action vivid and unusual helps strengthen recall.    
      </em></p>

      <div style="text-align: left; margin-top: 60px;">
        <em>Next, you will create and learn to utilise your own memory palace structure.</em>
      </div>
      
    </div>
  `,
  choices: ["Proceed"]
};

// Memory Palace Creation 1

const step_1 = {
type: jsPsychHtmlButtonResponse,
stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
    <div style="text-align: center; font-size: 36px; font-weight: 600; margin-bottom: 20px;">
        <strong>Creating Your Loci Memory Route</strong>
      </div>

      <p> 
         In this part of the task, you will build a personalised memory structure using the Method 
        of Loci, before using it later to memorise a list of new information.
      </p>

      <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Step 1: Choose a Familiar Setting</strong>
      </div>

      <!-- Bullet points with spacing -->
      <ul style="margin-left: 20px;">
        <li style="margin-bottom: 16px;">Think of a physical setting you know extremely well.</li>
        <li style="margin-bottom: 16px;">
          Choose somewhere you can easily visualise moving through in a set order, 
          noticing objects or landmarks along the way.
        </li>
        <li style="margin-bottom: 16px;">Take a moment to choose your setting now.</li>
      </ul>
      
    </div>
  `,
  choices: ["Proceed"]
};


// Memory Palace Creation 2


const step_2a = {
type: jsPsychHtmlKeyboardResponse,
stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
  
  <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
    <strong>Step 2: Plan a Clear Route</strong>
  </div>

  <ul style="margin-left: 20px;">
    <li style="margin-bottom: 16px;">
      Imagine walking through this setting from a clear starting point 
      (for example, entering through the front door of your home).
    </li>

    <li style="margin-bottom: 16px;">
      Visualise moving step by step through the space, noticing around 15 distinctive objects or 
      locations along the way.

      <ul style="margin-left: 20px; list-style-type: circle;">
        <li>Example items could include a front door, hallway mirror, couch, fridge, desk, etc.</li>
      </ul>
    </li>

    <li style="margin-bottom: 16px;">
      It is essential to structure your memory route as a clear, sequential path through the environment, rather than a disconnected collection of items scattered throughout the space. 
      
      <ul style="margin-left: 20px; list-style-type: circle;">
        <li> The more orderly and logical the route, the easier it will be to recall each locus as you learn and recall information. </li>
      </ul>
    </li>

      <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 20px;">
        <img src="Diagram3.png" style="width: 100%;" />
        
      </div>

    <li style="margin-bottom: 16px; margin-top: 40px;">
      <em>Take approximately 2 minutes to do this now. Feel free to close your eyes if you prefer.</em>
      </li>
  </ul>


</div>
`,
  choices: "NO_KEYS",
  trial_duration: 110000
  };

const step_2b = {
type: jsPsychHtmlButtonResponse,
stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
  
  <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
    <strong>Step 2: Plan a Clear Route</strong>
  </div>

  <ul style="margin-left: 20px;">
    <li style="margin-bottom: 16px;">
      Imagine walking through this setting from a clear starting point 
      (for example, entering through the front door of your home).
    </li>

    <li style="margin-bottom: 16px;">
      Visualise moving step by step through the space, noticing around 15 distinctive objects or 
      locations along the way.

      <ul style="margin-left: 20px; list-style-type: circle;">
        <li>Example items could include a front door, hallway mirror, couch, fridge, desk, etc.</li>
      </ul>
    </li>

    <li style="margin-bottom: 16px;">
      It is essential to structure your memory route as a clear, sequential path through the environment, rather than a disconnected collection of items scattered throughout the space. 
      
      <ul style="margin-left: 20px; list-style-type: circle;">
        <li> The more orderly and logical the route, the easier it will be to recall each locus as you learn and recall information. </li>
      </ul>
    </li>

      <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 20px;">
        <img src="Diagram3.png" style="width: 100%;" />
        
      </div>

    <li style="margin-bottom: 16px; margin-top: 40px;">
      <em>Take approximately 2 minutes to do this now. Feel free to close your eyes if you prefer.</em>
      </li>
  </ul>

</div>
`,
  choices: ["Proceed"]
};


const memoryLociForm = {
  type: jsPsychSurveyHtmlForm,
  preamble: `
    <div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
      <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Step 3: Write Down 15 Loci:</strong>
      </div>

      <p>Now that you've visualised your route, please write down the <strong>15 specific locations or objects</strong> (your loci) that you'll use to anchor new information.</p>
      <p><strong>Important:</strong> These should follow the order in which you would naturally move through the setting.</p>
      <p>Example: front door, hallway mirror, couch, coffee table, television...</p>
    </div>
  `,
  html: `
    ${[...Array(15)].map((_, i) =>
      `<p>${i + 1}. <input name="locus${i + 1}" type="text" style="width: 500px;" required></p>`
    ).join("")}
  `,
  button_label: "Save and Continue",
  on_finish: function(data) {
    jsPsych.data.addProperties({ memory_loci: data.response });
  }
};



const step4_rehearsala = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
    <div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
      <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Step 4: Mentally Rehearse Your Route</strong>
      </div>
      
      <p>Close your eyes and mentally walk through your chosen route, step by step, identifying each of the 15 loci in order from memory.</p>
      
    </div>
  `,
  choices: "NO_KEYS",
  trial_duration: 40000
};

const step4_rehearsalb = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
      <div style="font-size: 22px; font-weight: 600; margin-bottom: 12px;">
      <strong>Step 4: Mentally Rehearse Your Route</strong>
      </div>
      
      <p>Close your eyes and mentally walk through your chosen route, step by step, identifying each of the 15 loci in order from memory.</p>
      <p>Once you feel confident, press "Proceed" to continue.</p>
    </div>
  `,
  choices: ["Proceed"]
};


//Final task warning
const final_taskwarning = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
<div style="max-width: 800px; margin: auto; font-size: 18px; line-height: 1.8; text-align: left;">
      
    <div style="text-align: center; font-size: 36px; font-weight: 600; margin-bottom: 20px;">
    <strong>Practice Test</strong>
    </div>
<p>You will next be presented with 15 items to memorise, shown one at a time.</p>
      
      <p>You should use the loci memory structure you just created to help you remember items by mentally placing them sequentially along your route.</p>
      
    <p> This phase is solely intended for practice, so don't worry if it feels challenging, just give it your best go.</p>

      <ul style="margin-left: 20px; margin-top: 20px;">
        <li style="margin-bottom: 16px;">
          Eight of the items you'll see will be individual nouns (e.g., objects or things).
        </li>
        <li style="margin-bottom: 16px;">
          The other seven items will be everyday tasks, like the “reset router” example you saw earlier.
        </li>
      </ul>
      
      <p>Each noun will appear on the screen for 6.5 seconds, and each task will appear for 10 seconds.</p>
      
      <p>Once all items have been presented, you'll be directed to a page where you'll recall the list.</p>

      <p style="text-align: center; margin-top: 60px;">
        <em>Press "Proceed" to begin the task.</em>
      </p>
      
    </div>
  `,
  choices: ["Proceed"]
};


// ➤ Stimuli: 15 items
      const study_items = [
  "Compass",
  "Whistle",
  "Cactus",
  "Anchor",
  "Thermometer",
  "Salami",
  "Lantern",
  "Reaction",
  "Dust pantry",
  "Organise folders",
  "Defrost freezer",
  "Change batteries",
  "Descale kettle",
  "Replace medicine",
  "Hang Artwork"
];

// Split into nouns and tasks (first 8 are nouns, next 7 are tasks)
const noun_items = study_items.slice(0, 8);
const task_items = study_items.slice(8, 15);

// Interleave trials
const study_trials = [];

const max_pairs = Math.max(noun_items.length, task_items.length);

for (let i = 0; i < max_pairs; i++) {
  // If noun exists at this index, add it with 6.5s
  if (i < noun_items.length) {
    study_trials.push({
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
          <div style="font-size: 32px; color: black;">${noun_items[i]}</div>
        </div>
      `,
      choices: "NO_KEYS",
      trial_duration: 6500
    });

    // Red dot after noun if more items remain
    if (i < task_items.length || i < noun_items.length - 1) {
      study_trials.push({
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
          <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
            <div style="font-size: 48px; color: red;">•</div>
          </div>
        `,
        choices: "NO_KEYS",
        trial_duration: 500
      });
    }
  }

  // If task exists at this index, add it with 10s
  if (i < task_items.length) {
    study_trials.push({
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
          <div style="font-size: 32px; color: black;">${task_items[i]}</div>
        </div>
      `,
      choices: "NO_KEYS",
      trial_duration: 10000
    });

    // Red dot after task if more items remain
    if (i < noun_items.length - 1 || i < task_items.length - 1) {
      study_trials.push({
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
          <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
            <div style="font-size: 48px; color: red;">•</div>
          </div>
        `,
        choices: "NO_KEYS",
        trial_duration: 500
      });
    }
  }
}

jsPsych.data.addProperties({
  presented_study_items: study_items
});


  // Recall trial
  const practice_recall_trial = {
    type: jsPsychSurveyHtmlForm,
    preamble: `<p>Please type the 15 items you remember from the previous task. Enter one item per box.</p>
    <p>For any items you can't remember, type any singular key into the corresponding box/s.</p>`,

  html: `
    ${[...Array(15)].map((_, i) =>
      `<p>${i + 1}. <input name="item${i + 1}" type="text" style="width: 400px;" required></p>`
    ).join("")}
  `,
  button_label: "Submit",
   on_load: function() {
    // Prevent Enter key from submitting the form
    document.querySelector('form').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault(); // stops form submission
      }
    });
  },
 on_finish: function(data) {
    const participantResponses = Object.values(data.response).map(r => r.trim().toLowerCase());
    const correctItems = study_items.map(item => item.toLowerCase());
    
    const numCorrect = participantResponses.filter(response =>
      correctItems.includes(response)
    ).length;

    jsPsych.data.addProperties({
      practice_recall_responses: data.response,
      practice_recall_correct: numCorrect
    });
  }
};


const download_data_screen = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div style="text-align: center; font-size: 18px;">
      <p>You've completed this training session for the Method of Loci mnemonic strategy.</p>

      <p>We hope you'll find the strategy useful.</p>

      <p>Feel free to download your performance data by clicking the button below.</p>

      <p>Once you've done this, you can close the tab.</p>
    </div>
  `,
  choices: ['Download Data'],
  on_finish: function() {
    jsPsych.data.get().localSave('csv', 'test_trial_data.csv');
  }
};



timeline.push(Welcome_Page);
timeline.push(instruction_page_1a);
timeline.push(instruction_page_1b);
timeline.push(instruction_page_2a);
timeline.push(instruction_page_2b);
timeline.push(instruction_page_3a);
timeline.push(instruction_page_3b);
timeline.push(instruction_page_4a);
timeline.push(instruction_page_4b);
timeline.push(instruction_page_4c);
timeline.push(instruction_page_5a); 
timeline.push(instruction_page_5b);
timeline.push(instruction_page_5c);
timeline.push(step_1);
timeline.push(step_2a);
timeline.push(step_2b);
timeline.push(memoryLociForm);
timeline.push(step4_rehearsala);
timeline.push(step4_rehearsalb);
timeline.push(final_taskwarning);
timeline.push(red_dot_start);
timeline.push(...study_trials);
timeline.push(practice_recall_trial);
timeline.push(download_data_screen);




// Start the experiment

  jsPsych.run(timeline);

  </script>
</html>
